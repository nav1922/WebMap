'use strict';

module.exports = applyEmbeddedDiscriminators;

<<<<<<< HEAD
function applyEmbeddedDiscriminators(schema, seen = new WeakSet(), overwriteExisting = false) {
=======
function applyEmbeddedDiscriminators(schema, seen = new WeakSet()) {
>>>>>>> 133cd24d00c503c2f82710b8cbb50ea1868a2272
  if (seen.has(schema)) {
    return;
  }
  seen.add(schema);
  for (const path of Object.keys(schema.paths)) {
    const schemaType = schema.paths[path];
    if (!schemaType.schema) {
      continue;
    }
    applyEmbeddedDiscriminators(schemaType.schema, seen);
    if (!schemaType.schema._applyDiscriminators) {
      continue;
    }
<<<<<<< HEAD
    if (schemaType._appliedDiscriminators && !overwriteExisting) {
=======
    if (schemaType._appliedDiscriminators) {
>>>>>>> 133cd24d00c503c2f82710b8cbb50ea1868a2272
      continue;
    }
    for (const discriminatorKey of schemaType.schema._applyDiscriminators.keys()) {
      const discriminatorSchema = schemaType.schema._applyDiscriminators.get(discriminatorKey);
      applyEmbeddedDiscriminators(discriminatorSchema, seen);
<<<<<<< HEAD
      schemaType.discriminator(
        discriminatorKey,
        discriminatorSchema,
        overwriteExisting ? { overwriteExisting: true } : null
      );
=======
      schemaType.discriminator(discriminatorKey, discriminatorSchema);
>>>>>>> 133cd24d00c503c2f82710b8cbb50ea1868a2272
    }
    schemaType._appliedDiscriminators = true;
  }
}
